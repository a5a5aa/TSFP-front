import{Q as c}from"./QBtn.0ecae08c.js";import{Q}from"./QImg.bccb1aad.js";import{Q as b}from"./QTd.1bea88d2.js";import{Q as q,a as _,b as h}from"./QTable.caf83e39.js";import{Q as m}from"./QInput.2b55d701.js";import{Q as D}from"./QFile.d47c116a.js";import{a as v,Q as T}from"./QCard.c6fa8f42.js";import{Q as A}from"./QCardActions.f9670441.js";import{Q as B}from"./QForm.eb749f44.js";import{Q as U}from"./QDialog.70ecafb3.js";import{Q as W}from"./QPage.9f43aec5.js";import{a0 as y,an as S,ao as u,m as j,y as O,t as r,v as w,C as f,d as a,z as p,aw as $,D as F,az as x}from"./index.4d875d08.js";import"./QIcon.5ca772cc.js";import"./Ripple.cf9a4ce0.js";import"./use-router-link.2f5a64da.js";import"./vm.594ed3a6.js";import"./QSeparator.cc30faa3.js";import"./focus-manager.db5612a5.js";import"./QList.8e66e5ec.js";import"./rtl.b51694b1.js";import"./QItem.d2b8fa3b.js";import"./QItemLabel.548a6ea4.js";import"./position-engine.0a8b0a7e.js";import"./selection.efe461ed.js";import"./use-prevent-scroll.867bf119.js";import"./use-timeout.d612f645.js";import"./format.2a3572e1.js";import"./option-sizes.645a7745.js";const I={class:"q-px-lg q-py-xl row justify-between",style:{width:"100%"}},N=f("h5",{class:"col-8"},"\u6587\u7AE0\u7BA1\u7406",-1),ye={__name:"ArticlesView",setup(R){const C=["\u5FC3\u9748","\u81EA\u6211\u6210\u9577","\u54C1\u5473\u751F\u6D3B","\u85DD\u6587","\u8077\u5834","\u4EBA\u969B","\u8DA8\u52E2"],n={required(t){return!!t||"\u6B04\u4F4D\u5FC5\u586B"}},k=[{name:"date",required:!0,label:"\u767C\u4F48\u65E5\u671F",align:"center",field:t=>t.date,sortable:!0,format:t=>`${new Date(t).toLocaleDateString()}`},{name:"image",required:!0,label:"\u5716\u7247",align:"center",field:"image"},{name:"title",required:!0,label:"\u6587\u7AE0\u6A19\u984C",align:"center",field:"title",sortable:!0},{name:"shortDesc",required:!0,label:"\u7C21\u77ED\u8AAA\u660E",align:"center",field:"shortDesc"},{name:"articleText",required:!0,label:"\u6587\u7AE0\u5167\u5BB9",align:"center",field:"articleText"},{name:"category",required:!0,label:"\u5206\u985E",align:"center",field:"category",sortable:!0},{name:"status",label:"\u7DE8\u8F2F",align:"center",required:!0}],i=y([]),e=y({_id:"",title:"",articleText:"",shortDesc:"",category:"",keyWord:"",price:0,image:void 0,upload:!1,valid:!1,loading:!1,dialog:!1,idx:-1}),g=t=>{const l=i.findIndex(s=>s._id===t);l===-1?(e._id="",e.title="",e.shortDesc="",e.articleText="",e.keyWord="",e.image=void 0,e.upload=!1,e.category="",e.valid=!1,e.loading=!1,e.idx=-1):(e._id=i[l]._id,e.title=i[l].title,e.articleText=i[l].articleText,e.shortDesc=i[l].shortDesc,e.keyWord=i[l].keyWord,e.image=void 0,e.upload=i[l].upload,e.category=i[l].category,e.valid=!1,e.loading=!1,e.idx=l),e.dialog=!0},V=async()=>{var l,s;console.log(e),e.loading=!0;const t=new FormData;t.append("title",e.title),t.append("shortDesc",e.shortDesc),t.append("articleText",e.articleText),t.append("category",e.category),t.append("keyWord",e.keyWord),t.append("image",e.image),t.append("upload",e.upload);try{if(e._id.length===0)if(e.upload!==!1){const{data:d}=await x.post("/articles",t);i.push(d.result),u.fire({width:"18rem",icon:"success",text:"\u767C\u4F48\u6210\u529F",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1}),e.dialog=!1}else u.fire({width:"18rem",icon:"info",text:"\u8ACB\u78BA\u8A8D\u767C\u4F48",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1});else{const{data:d}=await x.patch("/articles/"+e._id,t);console.log(d),i[e.idx]=d.result,u.fire({width:"18rem",icon:"success",text:"\u7DE8\u8F2F\u6210\u529F",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1}),e.dialog=!1}}catch(d){u.fire({width:"18rem",icon:"error",text:((s=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:s.message)||"\u767C\u751F\u932F\u8AA4",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1})}e.loading=!1};return(async()=>{var t,l;try{const{data:s}=await S.get("/articles");i.push(...s.result),i.reverse()}catch(s){u.fire({width:"18rem",icon:"error",text:((l=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1})}})(),(t,l)=>{const s=w("q-card-title"),d=w("q-spacer");return j(),O(W,null,{default:r(()=>[f("div",I,[N,a(c,{icon:"add",class:"bg-warning text-white text-right q-mb-md",onClick:l[0]||(l[0]=o=>g(-1))},{default:r(()=>[p("\u65B0\u589E\u6587\u7AE0")]),_:1}),a(q,{rows:i,"row-key":"_id",columns:k,class:"article_table text-center col-12"},{"body-cell-image":r(o=>[a(b,null,{default:r(()=>[a(Q,{src:o.row.image,width:"160px",height:"90px"},null,8,["src"])]),_:2},1024)]),"body-cell-status":r(o=>[a(b,{class:"text-warning"},{default:r(()=>[a(c,{round:"",icon:"edit",flat:"",onClick:z=>g(o.row._id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows"]),a(U,{class:"q-pa-md q-gutter-sm row","no-shake":"",persistent:"",modelValue:e.dialog,"onUpdate:modelValue":l[9]||(l[9]=o=>e.dialog=o)},{default:r(()=>[a(v,{class:"row q-pa-xl"},{default:r(()=>[a(B,{style:{width:"1000px"},onSubmit:$(V,["prevent"])},{default:r(()=>[a(s,{class:"col-12"},{default:r(()=>[f("h5",null,F(e._id.length>0?"\u7DE8\u8F2F\u6587\u7AE0":"\u65B0\u589E\u6587\u7AE0"),1)]),_:1}),a(T,{class:"col-12 row justify-between"},{default:r(()=>[a(m,{"stack-label":"",class:"col-12",modelValue:e.title,"onUpdate:modelValue":l[1]||(l[1]=o=>e.title=o),label:"\u6587\u7AE0\u6A19\u984C",type:"text",color:"primary",rules:[n.required]},null,8,["modelValue","rules"]),a(m,{"stack-label":"",class:"col-12",modelValue:e.shortDesc,"onUpdate:modelValue":l[2]||(l[2]=o=>e.shortDesc=o),label:"\u7C21\u77ED\u8AAA\u660E",type:"text",color:"primary",rules:[n.required]},null,8,["modelValue","rules"]),a(m,{"stack-label":"",class:"col-12",modelValue:e.keyWord,"onUpdate:modelValue":l[3]||(l[3]=o=>e.keyWord=o),label:"\u95DC\u9375\u5B57",type:"text",color:"primary",rules:[n.required]},null,8,["modelValue","rules"]),a(_,{"stack-label":"",class:"col-4",modelValue:e.category,"onUpdate:modelValue":l[4]||(l[4]=o=>e.category=o),options:C,rules:[n.required],label:"\u5206\u985E"},null,8,["modelValue","rules"]),a(D,{"stack-label":"",class:"col-6",style:{"max-width":"300px"},modelValue:e.image,"onUpdate:modelValue":l[5]||(l[5]=o=>e.image=o),label:"\u4E0A\u50B3\u5716\u7247",accept:".jpg, image/*",onRejected:t.onRejected},null,8,["modelValue","onRejected"]),a(m,{autogrow:"","stack-label":"",filled:"",class:"col-12 q-mt-lg",modelValue:e.articleText,"onUpdate:modelValue":l[6]||(l[6]=o=>e.articleText=o),label:"\u6587\u7AE0\u5167\u5BB9",type:"textarea","auto-grow":"auto-grow",rules:[n.required]},null,8,["modelValue","rules"]),a(h,{"stack-label":"",class:"col-12",modelValue:e.upload,"onUpdate:modelValue":l[7]||(l[7]=o=>e.upload=o),label:"\u767C\u4F48",color:"primary",rules:[n.required],onClick:t.checkbox},null,8,["modelValue","rules","onClick"])]),_:1}),a(A,{class:"q-mt-md"},{default:r(()=>[a(d),a(c,{disabled:e.loading,color:"grey",onClick:l[8]||(l[8]=o=>e.dialog=!1)},{default:r(()=>[p("\u53D6\u6D88")]),_:1},8,["disabled"]),a(c,{disabled:e.loading,color:"warning",type:"submit"},{default:r(()=>[p("\u767C\u4F48")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})}}};export{ye as default};
