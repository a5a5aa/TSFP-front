import{Q as u}from"./QBtn.0ecae08c.js";import{Q as q}from"./QImg.bccb1aad.js";import{Q as g}from"./QTd.1bea88d2.js";import{Q,a as _,b as v}from"./QTable.caf83e39.js";import{Q as n}from"./QInput.2b55d701.js";import{Q as U}from"./QFile.d47c116a.js";import{a as B,Q as W}from"./QCard.c6fa8f42.js";import{Q as A}from"./QCardActions.f9670441.js";import{Q as D}from"./QForm.eb749f44.js";import{Q as S}from"./QDialog.70ecafb3.js";import{Q as j}from"./QPage.9f43aec5.js";import{a0 as b,an as h,ao as m,m as O,y as $,t as i,v as y,C as p,d as o,z as c,aw as F,D as I,az as w}from"./index.4d875d08.js";import"./QIcon.5ca772cc.js";import"./Ripple.cf9a4ce0.js";import"./use-router-link.2f5a64da.js";import"./vm.594ed3a6.js";import"./QSeparator.cc30faa3.js";import"./focus-manager.db5612a5.js";import"./QList.8e66e5ec.js";import"./rtl.b51694b1.js";import"./QItem.d2b8fa3b.js";import"./QItemLabel.548a6ea4.js";import"./position-engine.0a8b0a7e.js";import"./selection.efe461ed.js";import"./use-prevent-scroll.867bf119.js";import"./use-timeout.d612f645.js";import"./format.2a3572e1.js";import"./option-sizes.645a7745.js";const N={class:"q-px-lg q-py-xl row justify-between",style:{width:"100%"}},P=p("h5",{class:"col-6"},"\u6D3B\u52D5\u7BA1\u7406",-1),ye={__name:"ProductsView",setup(R){const V=["\u5FC3\u9748","\u52F5\u5FD7","\u81EA\u6211\u6210\u9577","\u85DD\u6587","\u751F\u6D3B\u98A8\u683C","\u540D\u4EBA\u8B1B\u5802","\u9AD4\u9A57"],d={required(a){return!!a||"\u6B04\u4F4D\u5FC5\u586B"},price(a){return a>=0||"\u50F9\u683C\u932F\u8AA4"}},k=[{name:"image",required:!0,label:"\u6D3B\u52D5\u5C01\u9762",align:"center",field:"image"},{name:"name",required:!0,label:"\u6D3B\u52D5\u540D\u7A31",align:"center",field:"name",sortable:!0},{name:"date",required:!0,label:"\u6D3B\u52D5\u65E5\u671F",align:"center",field:"date",sortable:!0,format:a=>`${new Date(a).toLocaleDateString()}`},{name:"starttime",required:!0,label:"\u958B\u59CB\u6642\u9593",align:"center",field:"starttime",sortable:!0},{name:"price",required:!0,label:"\u6D3B\u52D5\u8CBB\u7528",align:"center",field:"price",sortable:!0},{name:"category",required:!0,label:"\u5206\u985E",align:"center",field:"category",sortable:!0},{name:"status",label:"\u7DE8\u8F2F",align:"center",required:!0}],r=b([]),e=b({_id:"",name:"",date:"",starttime:"",endedtime:"",category:"",keyWord:"",price:"",description:"",image:void 0,sell:!1,valid:!1,loading:!1,dialog:!1,idx:-1}),f=a=>{const l=r.findIndex(s=>s._id===a);l===-1?(e._id="",e.name="",e.date="",e.starttime="",e.endedtime="",e.price="",e.description="",e.keyWord="",e.image=void 0,e.sell=!1,e.category="",e.valid=!1,e.loading=!1,e.idx=-1):(e._id=r[l]._id,e.name=r[l].name,e.date=r[l].date,e.starttime=r[l].starttime,e.endedtime=r[l].endedtime,e.price=r[l].price,e.description=r[l].description,e.keyWord=r[l].keyWord,e.image=void 0,e.sell=r[l].sell,e.category=r[l].category,e.valid=!1,e.loading=!1,e.idx=l),e.dialog=!0},C=async()=>{var l;console.log(e),e.loading=!0;const a=new FormData;a.append("name",e.name),a.append("date",e.date),a.append("starttime",e.starttime),a.append("endedtime",e.endedtime),a.append("category",e.category),a.append("price",e.price),a.append("description",e.description),a.append("keyWord",e.keyWord),a.append("image",e.image),a.append("sell",e.sell);try{if(e._id.length===0)if(e.sell!==!1){const{data:s}=await w.post("/products",a);r.push(s.result),m.fire({width:"18rem",icon:"success",text:"\u65B0\u589E\u6210\u529F",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1}),e.dialog=!1}else m.fire({width:"18rem",icon:"info ",text:"\u8ACB\u78BA\u8A8D\u4E0A\u67B6",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1});else{const{data:s}=await w.patch("/products/"+e._id,a);r[e.idx]=s.result,m.fire({width:"18rem",icon:"success",text:"\u7DE8\u8F2F\u6210\u529F",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1}),e.dialog=!1}}catch(s){m.fire({width:"18rem",icon:"error",text:((l=s==null?void 0:s.response)==null?void 0:l.data.message)||"\u767C\u751F\u932F\u8AA4",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1})}e.loading=!1};return(async()=>{var a;try{const{data:l}=await h.get("/products");r.push(...l.result),r.reverse()}catch(l){m.fire({width:"18rem",icon:"error",text:((a=l==null?void 0:l.response)==null?void 0:a.data.message)||"\u767C\u751F\u932F\u8AA4",iconColor:"#C5A768",confirmButtonColor:"#2b2b2b",allowOutsideClick:!1})}})(),(a,l)=>{const s=y("q-card-title"),x=y("q-spacer");return O(),$(j,null,{default:i(()=>[p("div",N,[P,o(u,{icon:"add",class:"bg-warning text-white text-right q-mb-md",onClick:l[0]||(l[0]=t=>f(-1))},{default:i(()=>[c("\u65B0\u589E\u6D3B\u52D5")]),_:1}),o(Q,{rows:r,"row-key":"_id",columns:k,class:"text-center col-12"},{"body-cell-image":i(t=>[o(g,null,{default:i(()=>[o(q,{src:t.row.image,width:"160px",height:"90px"},null,8,["src"])]),_:2},1024)]),"body-cell-status":i(t=>[o(g,{class:"text-warning"},{default:i(()=>[o(u,{round:"",icon:"edit",flat:"",onClick:T=>f(t.row._id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows"]),o(S,{class:"q-pa-md q-gutter-sm row","no-shake":"",persistent:"",modelValue:e.dialog,"onUpdate:modelValue":l[12]||(l[12]=t=>e.dialog=t)},{default:i(()=>[o(B,{class:"row q-pa-xl"},{default:i(()=>[o(D,{style:{width:"700px"},onSubmit:F(C,["prevent"])},{default:i(()=>[o(s,{class:"col-12"},{default:i(()=>[p("h5",null,I(e._id.length>0?"\u7DE8\u8F2F\u6D3B\u52D5":"\u65B0\u589E\u6D3B\u52D5"),1)]),_:1}),o(W,{class:"col-12 row justify-between"},{default:i(()=>[o(n,{"stack-label":"",class:"col-7",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),label:"\u6D3B\u52D5\u540D\u7A31",type:"text",color:"primary",rules:[d.required]},null,8,["modelValue","rules"]),o(_,{"stack-label":"",class:"col-4",modelValue:e.category,"onUpdate:modelValue":l[2]||(l[2]=t=>e.category=t),options:V,rules:[d.required],label:"\u5206\u985E"},null,8,["modelValue","rules"]),o(n,{"stack-label":"",class:"col-4",modelValue:e.date,"onUpdate:modelValue":l[3]||(l[3]=t=>e.date=t),label:"\u6D3B\u52D5\u65E5\u671F",type:"date",color:"primary",rules:[d.required]},null,8,["modelValue","rules"]),o(n,{"stack-label":"",class:"col-3",modelValue:e.starttime,"onUpdate:modelValue":l[4]||(l[4]=t=>e.starttime=t),label:"\u958B\u59CB\u6642\u9593",type:"time",color:"primary",rules:[d.required]},null,8,["modelValue","rules"]),o(n,{"stack-label":"",class:"col-3",modelValue:e.endedtime,"onUpdate:modelValue":l[5]||(l[5]=t=>e.endedtime=t),label:"\u7D50\u675F\u6642\u9593",type:"time",color:"primary",rules:[d.required]},null,8,["modelValue","rules"]),o(n,{"stack-label":"",class:"col-3",modelValue:e.price,"onUpdate:modelValue":l[6]||(l[6]=t=>e.price=t),label:"\u5831\u540D\u8CBB",type:"text",prefix:"$",color:"primary",rules:[d.price]},null,8,["modelValue","rules"]),o(n,{"stack-label":"",class:"col-3",modelValue:e.keyWord,"onUpdate:modelValue":l[7]||(l[7]=t=>e.keyWord=t),label:"\u95DC\u9375\u5B57",type:"text",color:"primary",rules:[d.required]},null,8,["modelValue","rules"]),o(U,{"stack-label":"",class:"col-4",style:{"max-width":"300px"},modelValue:e.image,"onUpdate:modelValue":l[8]||(l[8]=t=>e.image=t),label:"\u4E0A\u50B3\u5716\u7247",accept:".jpg, image/*",onRejected:a.onRejected},null,8,["modelValue","onRejected"]),o(n,{"stack-label":"",filled:"",class:"col-12 q-mt-lg",modelValue:e.description,"onUpdate:modelValue":l[9]||(l[9]=t=>e.description=t),label:"\u6D3B\u52D5\u8AAA\u660E",type:"textarea","auto-grow":"auto-grow",rules:[d.required]},null,8,["modelValue","rules"]),o(v,{"stack-label":"",class:"col-12",modelValue:e.sell,"onUpdate:modelValue":l[10]||(l[10]=t=>e.sell=t),label:"\u4E0A\u67B6",color:"primary",rules:[d.required],onClick:a.checkbox},null,8,["modelValue","rules","onClick"])]),_:1}),o(A,{class:"q-mt-md"},{default:i(()=>[o(x),o(u,{disabled:e.loading,color:"grey",onClick:l[11]||(l[11]=t=>e.dialog=!1)},{default:i(()=>[c("\u53D6\u6D88")]),_:1},8,["disabled"]),o(u,{disabled:e.loading,color:"warning",type:"submit"},{default:i(()=>[c("\u9001\u51FA")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})}}};export{ye as default};
